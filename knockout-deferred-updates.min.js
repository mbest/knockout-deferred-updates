/*
 Deferred Updates plugin for Knockout http://knockoutjs.com/
 (c) Michael Best, Steven Sanderson
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 3.2.0
*/
(function(e){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?e(require("knockout")):"function"===typeof define&&define.amd?define(["knockout"],e):e(ko)})(function(e){function m(a,c){for(var b in a)if(a.hasOwnProperty(b)&&a[b]&&0<=a[b].toString().indexOf(c))return b}function u(a,c){for(var b in a)if(a.hasOwnProperty(b)&&a[b]===c)return b}function ea(a,c,b,e){var f=a.subscribe(c,null,"dirty",!1,e),g=a.subscribe(b,null,"change",!1,e);return{dispose:function(){f.dispose();
g.dispose()},target:a}}var F="object"===typeof global&&global?global:window;if(!e)throw Error("Deferred Updates requires Knockout");if("3.3.0"<=e.version)throw Error("This version of Deferred Updates supports Knockout version 3.2 and lower.");e.tasks=function(){function a(d){var a=0,b=0;k=k._next={_mark:!0};try{for(var c=d;c=c._next;)if(m=c,c._mark){if(c._next){if(5E3<=++b)throw Error("'Too much recursion' after processing "+a+" tasks.");k=k._next={_mark:!0}}}else c._done||(c._done=!0,c._func.apply(c.object,
c.args||[]),++a)}finally{if(d!==z)d._next=null,k=d;else{h=[];z._next=null;n=k=z;if(g)F[f](g);g=void 0}m=void 0}return a}function c(){if(!m)return a(z)}var b,f;F.setImmediate?(b="setImmediate",f="clearImmediate"):(b="setTimeout",f="clearTimeout");var g,z={},k=z,h=[],m,n=z,v={processImmediate:function(d,b,c){h.push(n);n=k;try{return d.apply(b,c||[])}finally{try{n._next&&a(n)}finally{n=h.pop()||z}}},processDelayed:function(d,a,e){2==arguments.length&&"object"==typeof a&&(e=a,a=e.distinct);var f;if(f=
a||void 0===a)a:{f=m||n;for(var l;l=f._next;f=l)if(l._func===d&&!l._done){f._next=l._next;f._next||(k=f);f=!0;break a}f=!1}l=e||{};l._func=d;k=k._next=l;h.length||g||(g=F[b](c));return!f},makeProcessedCallback:function(a){return function(){return v.processImmediate(a,this,arguments)}}};e.processDeferredBindingUpdatesForNode=e.processAllDeferredBindingUpdates=function(){for(var a=z;a=a._next;)a.node&&!a._done&&(a._done=!0,a._func.call())};e.processAllDeferredUpdates=c;e.evaluateAsynchronously=function(a,
b){return setTimeout(v.makeProcessedCallback(a),b)};return v}();var x=e.utils,P=x.objectForEach||function(a,c){for(var b in a)a.hasOwnProperty(b)&&c(b,a[b])},V=x.arrayForEach,fa={__proto__:[]}instanceof Array?function(a,c){a.__proto__=c;return a}:x.extend,g=function(a,c){for(var b in a)if(a.hasOwnProperty(b)&&a[b]&&a[b][c])return a[b]}(e,"end"),ga=m(g,".apply(")||"ignore",J=m(g,".push"),W=m(g,"Only subscribable"),ha=g.isInitial?u(g,g.isInitial):"isInitial",w=e.computed,ia=function(a,c){var b=[],e;
for(e in a)a.hasOwnProperty(e)&&a[e]===c&&b.push(e);return b}(e,w),L=u(w.fn,w),f=e.computed(function(){}),ja=u(f,f.peek)||"peek",ka=u(f,f.isActive)||"isActive",X=u(f,f.getDependenciesCount),Y=u(f,!1),la=u(f,f.dispose),Z="disposeWhenNodeIsRemoved",$="disposeWhen";if("hasWriteFunction"!=Y){var f=w.toString(),A;if(A=f.match(/.\.disposeWhenNodeIsRemoved\s*\|\|\s*.\.([^|\s,]+)/))Z=A[1];if(f=f.match(/.\.disposeWhen\s*\|\|\s*.\.([^|\s,]+)/))$=f[1]}var ma=m(x,"documentElement)")||m(x,"ocument)"),f=e.subscribable.fn;
A=m(f,".bind(");var M=m(f,"notifySubscribers"),h=(new e.subscribable).subscribe(),B=h.constructor.prototype,N=u(B,h.dispose);h.dispose();var h=null,aa,ba;M&&e.extenders.rateLimit&&(h=(new e.subscribable).extend({rateLimit:1}),ba=m(h,"=!0")||"_rateLimitedChange",aa=m(h,"||(")||"_rateLimitedBeforeChange",h=null);var K,ca;e.pureComputed&&(h=e.pureComputed(function(){}),K=m(h,"!1,")||"beforeSubscriptionAdd",ca=m(h,"()||")||"afterSubscriptionRemove",h=null);var da=[],r,na=0;g[J]=function(a){da.push(r);
r=a};g.end=function(){r=da.pop()};g[W]=function(a){if(r){if(!e.isSubscribable(a))throw Error("Only subscribable things can act as dependencies");r.callback(a,a._id||(a._id=++na))}};e.ignoreDependencies=g[ga]=function(a,c,b){try{return g[J](),a.apply(c,b||[])}finally{g.end()}};g[X]=g.getDependenciesCount=function(){if(r)return r.computed.getDependenciesCount()};g[ha]=g.isInitial=function(){if(r)return r.isInitial};var oa=f[A];f[A]=f.subscribe=function(a,c,b,f,g){b=b||"change";if(g)"change"==b&&(this.dependents=
this.dependents||[],this.dependents.push(g));else{var h=c?a.bind(c):a;a="change"!=b?h:function(a){n.deferUpdates&&!1!==k.deferUpdates||k.deferUpdates?e.tasks.processDelayed(h,{args:[a]}):h(a)}}var k=oa.call(this,a,null,b);k.target=this;k.event=b;k.dependent=g;k.deferUpdates=f;return k};var H=f.notifySubscribers,y;f.notifySubscribers=function(a,c){if("change"===c||"dirty"===c||void 0===c)if(y)y.push([this,a,c]);else try{if(y=[],H.call(this,a,c),y.length)for(var b=0,e;e=y[b];b++)Function.prototype.call.apply(H,
e)}finally{y=null}else H.call(this,a,c)};f.getDependents=function(){return this.dependents?[].concat(this.dependents):[]};var pa=B[N];B[N]=B.dispose=function(){pa.call(this);this.dependent&&"change"==this.event&&x.arrayRemoveItem(this.target.dependents,this.dependent)};var n=function(a,c,b){function f(a,b){if(!C[b]){var c;c=a[L]===n?ea(a,u,r,d):a.subscribe(r,null,"change",!1,d);C[b]=c;q++}}function h(){P(C,function(a,b){b.dispose()});C={}}function m(){h();q=0;F=!0;V(Q,function(a){a.dispose()});Q=
[];l=p=!1}function k(a,b){var c="dirty"==b,f=c&&!l&&!p;c?l=!0:p=!0;(c=d.throttleEvaluation)&&0<=c?(clearTimeout(R),R=e.evaluateAsynchronously(v,c)):d._evalRateLimited?d._evalRateLimited():n.deferUpdates&&!1!==d.deferUpdates||d.deferUpdates?f=e.tasks.processDelayed(v,{node:D}):p&&(v(),f=!1);f&&d.notifySubscribers&&(d.notifySubscribers(s,"dirty"),!l&&c&&clearTimeout(R))}function r(a){l||p?p=!0:k(a,"change")}function u(a){k(a,"dirty")}function w(){if(F)return!0;if(S&&S()){if(!B)return G(),p=!1,!0}else B=
!1}function v(a){if(E||!p&&!0!==a)l=p;else if(!w()){E=!0;if(I)try{var b={};g[J]({callback:function(a,c){b[c]||(b[c]=1,++q)},computed:d,isInitial:void 0});q=0;s=t.call(c)}finally{g.end(),E=!1}else try{var e=C,h=q;g[J]({callback:function(a,b){F||(h&&e[b]?(C[b]=e[b],++q,delete e[b],--h):f(a,b))},computed:d,isInitial:H?void 0:!q});C={};q=0;try{var k=c?t.call(c):t()}finally{g.end(),h&&P(e,function(a,b){b.dispose()}),l=p=!1}d.equalityComparer&&d.equalityComparer(s,k)||(d.notifySubscribers(s,"beforeChange"),
s=k,d._latestValue=s,!0!==a&&d.notifySubscribers(s))}finally{E=!1}q||G()}}function d(){if(0<arguments.length){if("function"===typeof T){var a=d.deferUpdates;d.deferUpdates=!1;try{T.apply(c,arguments)}finally{d.deferUpdates=a}}else throw Error('Cannot write a value to a ko.computed unless you specify a "write" option. If you wish to read the current value, don\'t pass any parameters.');return this}g[W](d);(p||l)&&v(!0);return s}function y(){!p&&!l||q||v(!0);return s}function A(){return p||l||0<q}var s,
l=!1,p=!0,E=!1,B=!1,F=!1,t=a,H=!1,I=!1;t&&"object"==typeof t?(b=t,t=b.read):(b=b||{},t||(t=b.read));if("function"!=typeof t)throw Error("Pass a function that returns the value of the ko.computed");var O,T=b.write,D=b[Z]||b.disposeWhenNodeIsRemoved||null,U=b[$]||b.disposeWhen,S=U,G=m,C={},q=0,Q=[],R=null;c||(c=b.owner);e.subscribable.call(d);fa(d,n.fn);d[ja]=d.peek=y;d[X]=d.getDependenciesCount=function(){return q};d[Y]=d.hasWriteFunction="function"===typeof T;d[la]=d.dispose=function(){G()};d[ka]=
d.isActive=A;d.activeWhen=function(a){O||(O=e.computed(function(){E=!a();!E&&p&&k(void 0,"change")}),O.deferUpdates=!1,Q.push(O))};d.getDependencies=function(){var a=[];P(C,function(b,c){a.push(c.target)});return a};if(M){var N=d[M];d[M]=function(a){N.call(d,a);d._evalRateLimited=function(){l=p=!1;d[aa](s);p=!0;d[ba](d)}}}K&&(b.pure?(I=H=!0,d[K]=function(){I&&(I=!1,v(!0))},d[ca]=function(){d.getSubscriptionsCount()||(h(),I=p=!0)}):b.deferEvaluation&&(d[K]=function(){y();delete d[K]}));D&&(B=!0,D.nodeType&&
(S=function(){return!x[ma](D)||U&&U()}));if(!w()&&!I&&!b.deferEvaluation){E=!0;try{g[J]({callback:f,computed:d,isInitial:!0}),d._latestValue=s=t.call(c)}finally{g.end(),p=E=!1}q||G()}D&&A()&&D.nodeType&&(G=function(){x.domNodeDisposal.removeDisposeCallback(D,G);m()},x.domNodeDisposal.addDisposeCallback(D,G));return d};n[L]=w[L];n.fn=w.fn;n.fn[L]=n;n.deferUpdates=!0;V(ia,function(a){e[a]=n});w=f=null;e.extenders.throttle=function(a,c){if(e.isWriteableObservable(a)){var b=null;return e.computed({read:a,
write:function(f){clearTimeout(b);b=e.evaluateAsynchronously(function(){a(f)},c)}})}a.throttleEvaluation=c;return a};e.extenders.deferred=function(a,c){a.deferUpdates=c};return e});
