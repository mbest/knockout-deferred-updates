/*
 Deferred Updates plugin for Knockout http://knockoutjs.com/
 (c) Michael Best, Steven Sanderson
 License: MIT (http://www.opensource.org/licenses/mit-license.php)
 Version 3.2.1
*/
(function(e){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?module.exports=e(require("knockout")):"function"===typeof define&&define.amd?define(["knockout"],e):e(ko)})(function(e){function l(a,d){for(var c in a)if(a.hasOwnProperty(c)&&a[c]&&0<=a[c].toString().indexOf(d))return c}function v(a,d){for(var c in a)if(a.hasOwnProperty(c)&&a[c]===d)return c}function fa(a,d,c,e){var f=a.subscribe(d,null,"dirty",!1,e),g=a.subscribe(c,null,"change",!1,e);return{dispose:function(){f.dispose();
g.dispose()},target:a}}var G="object"===typeof global&&global?global:window;if(!e)throw Error("Deferred Updates requires Knockout");if("3.3.0"<=e.version)throw Error("This version of Deferred Updates supports Knockout version 3.2 and lower.");e.tasks=function(){function a(b){var a=0,c=0;k=k._next={_mark:!0};try{for(var d=b;d=d._next;)if(l=d,d._mark){if(d._next){if(5E3<=++c)throw Error("'Too much recursion' after processing "+a+" tasks.");k=k._next={_mark:!0}}}else d._done||(d._done=!0,d._func.apply(d.object,
d.args||[]),++a)}finally{if(b!==A)b._next=null,k=b;else{h=[];A._next=null;m=k=A;if(g)G[f](g);g=void 0}l=void 0}return a}function d(){if(!l)return a(A)}var c,f;G.setImmediate?(c="setImmediate",f="clearImmediate"):(c="setTimeout",f="clearTimeout");var g,A={},k=A,h=[],l,m=A,w={processImmediate:function(b,c,d){h.push(m);m=k;try{return b.apply(c,d||[])}finally{try{m._next&&a(m)}finally{m=h.pop()||A}}},processDelayed:function(b,a,e){2==arguments.length&&"object"==typeof a&&(e=a,a=e.distinct);var f;if(f=
a||void 0===a)a:{f=l||m;for(var q;q=f._next;f=q)if(q._func===b&&!q._done){f._next=q._next;f._next||(k=f);f=!0;break a}f=!1}q=e||{};q._func=b;k=k._next=q;h.length||g||(g=G[c](d));return!f},makeProcessedCallback:function(b){return function(){return w.processImmediate(b,this,arguments)}}};e.processDeferredBindingUpdatesForNode=e.processAllDeferredBindingUpdates=function(){for(var b=A;b=b._next;)b.node&&!b._done&&(b._done=!0,b._func.call())};e.processAllDeferredUpdates=d;e.evaluateAsynchronously=function(b,
a){return setTimeout(w.makeProcessedCallback(b),a)};return w}();var y=e.utils,Q=y.objectForEach||function(a,d){for(var c in a)a.hasOwnProperty(c)&&d(c,a[c])},W=y.arrayForEach,ga={__proto__:[]}instanceof Array?function(a,d){a.__proto__=d;return a}:y.extend,g=function(a,d){for(var c in a)if(a.hasOwnProperty(c)&&a[c]&&a[c][d])return a[c]}(e,"end"),ha=l(g,".apply(")||"ignore",K=l(g,".push"),X=l(g,"Only subscribable"),ia=g.isInitial?v(g,g.isInitial):"isInitial",x=e.computed,ja=function(a,d){var c=[],e;
for(e in a)a.hasOwnProperty(e)&&a[e]===d&&c.push(e);return c}(e,x),M=v(x.fn,x),f=e.computed(function(){}),ka=v(f,f.peek)||"peek",la=v(f,f.isActive)||"isActive",Y=v(f,f.getDependenciesCount),Z=v(f,!1),ma=v(f,f.dispose),$="disposeWhenNodeIsRemoved",aa="disposeWhen";if("hasWriteFunction"!=Z){var f=x.toString(),B;if(B=f.match(/.\.disposeWhenNodeIsRemoved\s*\|\|\s*.\.([^|\s,]+)/))$=B[1];if(f=f.match(/.\.disposeWhen\s*\|\|\s*.\.([^|\s,]+)/))aa=f[1]}var na=l(y,"documentElement)")||l(y,"ocument)"),f=e.subscribable.fn;
B=l(f,".bind(");var N=l(f,"notifySubscribers"),h=(new e.subscribable).subscribe(),C=h.constructor.prototype,O=v(C,h.dispose);h.dispose();var h=null,ba,ca;N&&e.extenders.rateLimit&&(h=(new e.subscribable).extend({rateLimit:1}),ca=l(h,"=!0")||"_rateLimitedChange",ba=l(h,"||(")||"_rateLimitedBeforeChange",h=null);var L,da;e.pureComputed&&(h=e.pureComputed(function(){}),L=l(h,"!1,")||"beforeSubscriptionAdd",da=l(h,"()||")||"afterSubscriptionRemove",h=null);var ea=[],s,oa=0;g[K]=function(a){ea.push(s);
s=a};g.end=function(){s=ea.pop()};g[X]=function(a){if(s){if(!e.isSubscribable(a))throw Error("Only subscribable things can act as dependencies");s.callback(a,a._id||(a._id=++oa))}};e.ignoreDependencies=g[ha]=function(a,d,c){try{return g[K](),a.apply(d,c||[])}finally{g.end()}};g[Y]=g.getDependenciesCount=function(){if(s)return s.computed.getDependenciesCount()};g[ia]=g.isInitial=function(){if(s)return s.isInitial};var pa=f[B];f[B]=f.subscribe=function(a,d,c,f,g){c=c||"change";if(g)"change"==c&&(this.dependents=
this.dependents||[],this.dependents.push(g));else{var h=d?a.bind(d):a;a="change"!=c?h:function(a){m.deferUpdates&&!1!==k.deferUpdates||k.deferUpdates?e.tasks.processDelayed(h,{args:[a]}):h(a)}}var k=pa.call(this,a,null,c);k.target=this;k.event=c;k.dependent=g;k.deferUpdates=f;return k};var I=f.notifySubscribers,z;f.notifySubscribers=function(a,d){if("change"===d||"dirty"===d||void 0===d)if(z)z.push([this,a,d]);else try{if(z=[],I.call(this,a,d),z.length)for(var c=0,e;e=z[c];c++)Function.prototype.call.apply(I,
e)}finally{z=null}else I.call(this,a,d)};f.getDependents=function(){return this.dependents?[].concat(this.dependents):[]};var qa=C[O];C[O]=C.dispose=function(){qa.call(this);this.dependent&&"change"==this.event&&y.arrayRemoveItem(this.target.dependents,this.dependent)};var m=function(a,d,c){function f(a,c){if(!D[c]){var d;d=a[M]===m?fa(a,v,s,b):a.subscribe(s,null,"change",!1,b);D[c]=d;r++}}function h(){Q(D,function(a,b){b.dispose()});D={}}function l(){h();r=0;G=!0;W(R,function(a){a.dispose()});R=
[];t=n=!1}function k(a,c){var d="dirty"==c,f=d&&!t&&!n;d?t=!0:n=!0;(d=b.throttleEvaluation)&&0<=d?(clearTimeout(S),S=e.evaluateAsynchronously(function(){w()},d)):b._evalRateLimited?b._evalRateLimited():m.deferUpdates&&!1!==b.deferUpdates||b.deferUpdates?f=e.tasks.processDelayed(w,{node:E}):n&&(w(),f=!1);f&&b.notifySubscribers&&(b.notifySubscribers(p,"dirty"),!t&&d&&clearTimeout(S))}function s(a){t||n?n=!0:k(a,"change")}function v(a){k(a,"dirty")}function x(){if(G)return!0;if(T&&T()){if(!C)return H(),
n=!1,!0}else C=!1}function w(a){if(!F)if(!n&&!a)t=n,b.equalityComparer&&b.equalityComparer(p,q)||(q=p,b.notifySubscribers(p));else if(!x()){F=!0;if(J)try{var c={};g[K]({callback:function(a,b){c[b]||(c[b]=1,++r)},computed:b,isInitial:void 0});r=0;b._latestValue=p=u.call(d)}finally{g.end(),F=!1}else try{var e=D,h=r,k=I?void 0:!r;g[K]({callback:function(a,b){G||(h&&e[b]?(D[b]=e[b],++r,delete e[b],--h):f(a,b))},computed:b,isInitial:k});D={};r=0;try{var l=d?u.call(d):u()}finally{g.end(),h&&Q(e,function(a,
b){b.dispose()}),t=n=!1}b.equalityComparer&&b.equalityComparer(p,l)||(b.notifySubscribers(p,"beforeChange"),p=l,b._latestValue=p,a||(q=p,b.notifySubscribers(p)));k&&(q=p)}finally{F=!1}r||H()}}function b(){if(0<arguments.length){if("function"===typeof U){var a=b.deferUpdates;b.deferUpdates=!1;try{U.apply(d,arguments)}finally{b.deferUpdates=a}}else throw Error('Cannot write a value to a ko.computed unless you specify a "write" option. If you wish to read the current value, don\'t pass any parameters.');
return this}g[X](b);(n||t)&&w(!0);return p}function z(){!n&&!t||r||w(!0);return p}function B(){return n||t||0<r}var p,q,t=!1,n=!0,F=!1,C=!1,G=!1,u=a,I=!1,J=!1;u&&"object"==typeof u?(c=u,u=c.read):(c=c||{},u||(u=c.read));if("function"!=typeof u)throw Error("Pass a function that returns the value of the ko.computed");var P,U=c.write,E=c[$]||c.disposeWhenNodeIsRemoved||null,V=c[aa]||c.disposeWhen,T=V,H=l,D={},r=0,R=[],S=null;d||(d=c.owner);e.subscribable.call(b);ga(b,m.fn);b[ka]=b.peek=z;b[Y]=b.getDependenciesCount=
function(){return r};b[Z]=b.hasWriteFunction="function"===typeof U;b[ma]=b.dispose=function(){H()};b[la]=b.isActive=B;b.activeWhen=function(a){P||(P=e.computed(function(){F=!a();!F&&n&&k(void 0,"change")}),P.deferUpdates=!1,R.push(P))};b.getDependencies=function(){var a=[];Q(D,function(b,c){a.push(c.target)});return a};if(N){var O=b[N];b[N]=function(a){O.call(b,a);b._evalRateLimited=function(){t=n=!1;b[ba](p);n=!0;b[ca](b)}}}L&&(c.pure?(J=I=!0,b[L]=function(){J&&(J=!1,w(!0),q=p)},b[da]=function(){b.getSubscriptionsCount()||
(h(),J=n=!0,q=void 0)}):c.deferEvaluation&&(b[L]=function(){z();delete b[L]}));E&&(C=!0,E.nodeType&&(T=function(){return!y[na](E)||V&&V()}));if(!x()&&!J&&!c.deferEvaluation){F=!0;try{g[K]({callback:f,computed:b,isInitial:!0}),b._latestValue=p=q=u.call(d)}finally{g.end(),n=F=!1}r||H()}E&&B()&&E.nodeType&&(H=function(){y.domNodeDisposal.removeDisposeCallback(E,H);l()},y.domNodeDisposal.addDisposeCallback(E,H));return b};m[M]=x[M];m.fn=x.fn;m.fn[M]=m;m.deferUpdates=!0;W(ja,function(a){e[a]=m});x=f=null;
e.extenders.throttle=function(a,d){if(e.isWriteableObservable(a)){var c=null;return e.computed({read:a,write:function(f){clearTimeout(c);c=e.evaluateAsynchronously(function(){a(f)},d)}})}a.throttleEvaluation=d;return a};e.extenders.deferred=function(a,d){a.deferUpdates=d};return e});
